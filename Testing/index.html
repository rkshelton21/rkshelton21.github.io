<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <div>This is version 4.4</div>
    <div id="jsTest1" class="d">Javascript is: Not working.</div>
    <div id="jsTest2" class="d">JQuery is: Not Loaded.</div>
    <input id="ajaxLoad" style="float:left"></input>
    <button id="loadButton">Load Async</button>
    <button id="stageTest">Click to Test</button>
    <p></p>
    <div id="stage"></div>
    <div id="errs">Errors:</div>
    <button id="ClearErrors">Clear Errors</button>
  </body>
  <script>
      var nextStage = 1;
      try
      {
          var jst = document.getElementById("jsTest1");
          jst.innerHTML = jst.innerHTML.replace("Not", "Is");
      }
      catch(err)
      {
          document.getElementById("errs").innerHTML += err.message;
      }
      
      function bindStageTest()
      {
        $('#stageTest').on('click', stageTest);
      }
      
      function stageTest()
      {
        var stage = nextStage++;
        if(stage == 1){ stage3(); }
        if(stage == 2){ stage1(); }
        if(stage == 3){ stage2(); }
        if(stage == 4){ stage4(); }
        if(stage == 5){ stage5(); }
        if(stage == 6){ stage6(); }
        if(stage == 7){ stage7(); }
        if(stage == 8){ stage8(); }
      }
      
      function loadAsync (link)
      {
          $.getScript( link )
              .done(function( script, textStatus ) 
              {
                  var newDiv = '<div class="d">TEMP: Loaded</div>';
                  newDiv = newDiv.replace('TEMP', link);
                  $('#ajaxLoad').val('');
                  $('.d').last().append(newDiv);
              })
              .fail(function( jqxhr, settings, exception ) 
              {
                  document.getElementById("errs").innerHTML += "<p>" + "Triggered ajaxError handler: " + exception + "</p>";
              });
      };
      
      function loadSync (link)
      {
          if(link !== '')
          {
            $.ajax({
              url: link,
              dataType: "script",
              success: function( script, textStatus ) 
                {
                    var newDiv = '<div class="d">TEMP: Loaded</div>';
                    newDiv = newDiv.replace('TEMP', link);
                    $('#ajaxLoad').val('');
                    $('.d').last().append(newDiv);
                },
              error: function( jqxhr, settings, exception ) 
                {
                    document.getElementById("errs").innerHTML += "<p>" + "Triggered ajaxError handler: " + exception + "</p>";
                }
            });
          }
      };
      
      try
      {
          function bindAsyncLoad ()
          {
              $('#loadButton').on('click', loadAsync($('#ajaxLoad').val()));
          };
      }
      catch(err)
      {
          document.getElementById("errs").innerHTML += err.message;
      }
      
      try
      {
          // Anonymous "self-invoking" function
          (function() {
              // Load the script
              var script = document.createElement("SCRIPT");
              script.src = 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js';
              script.type = 'text/javascript';
              document.getElementsByTagName("head")[0].appendChild(script);
          
              // Poll for jQuery to come into existance
              var checkReady = function(callback) {
                  if (window.jQuery) {
                      callback(jQuery);
                  }
                  else {
                      window.setTimeout(function() { checkReady(callback); }, 100);
                  }
              };
          
              // Start polling...
              checkReady(function($) {
                  try
                  {
                      $('#jsTest2').html($('#jsTest2').html().replace('Not', 'Is'));
                      bindAsyncLoad();
                      $('#ClearErrors').on('click', function(){ document.getElementById("errs").innerHTML = ''});
                      bindStageTest();
                  }
                  catch(err)
                  {
                      document.getElementById("errs").innerHTML += err.message;
                  }
              });
          })();
      }
      catch(err)
      {
          alert(err);
          document.getElementById("errs").innerHTML += err.message;
      }
      
      function stage1()
      {
          loadSync('http://asset01.drivewebsite.com/prod-web/Shared/CombinerOutput_JS.js.gz?v=10');
          $('#stage').html($('#stage').html() + '<p>Stage 1 Complete</p>');
      }
      function stage2()
      {
          LoadDDSGlobals();
          $('#stage').html($('#stage').html() + '<p>Stage 2 Complete</p>');
      }
      function stage3()
      {
        try{var ddsVars={platformId:"AWP",trackingLink:"https://localhost:1190/Cms/EventTracking/TrackEvent",page:{id:"70d39881-c79a-440c-a31b-c8f7c19dcdfe",name:"Home",notes:"Homepage",title:"Dominion Dealer Solutions | Any City, Any State"},site:{id:"3901b2b4-2cad-4c81-84b7-b068ae4ceb48",name:"Nissan Demo",url:"http://nissandemo.stage.drivewebsite.com",tags:""},search:{body:"",engine:"",make:"",model:"",stockType:"",trim:"",year:""},vehicle:{body:"",comment:"",dealer:{city:"",name:"",state:""},engine:"",make:"",model:"",stockNumber:"",stockType:"",trim:"",vin:"",year:""},data:{omnSuiteIdSite:"@Data.omnSuiteidsite",install:{dataium:"@Data.InstallDataiumCode",enquireJs:"@Data.InstallEnquireJS"},googleAnalyticsAccount:"@Data.googleAnalyticsAccount",dealer:{name:"Dominion Dealer Solutions",city:"Any City",state:"Any State",zip:"00000"},tms:{dealerCode:"@Data.toyotaDealerCode",regionCode:"@Data.toyotaRegionCode",districtCode:"@Data.toyotaDistrictCode",tda:"@Data.toyotaTDA"},sms:{dealerCode:"@Data.scionDealerCode",regionCode:"@Data.scionRegionCode",districtCode:"@Data.scionDistrictCode"}}};if("".indexOf("@")==-1){ddsVars.vehicle={body:"",comment:"",dealer:{city:"",name:"",state:""},engine:"",make:"",model:"",stockNumber:"",stockType:"",trim:"",vin:"",year:""}}}catch(err){var ddsVars={}}
        $('#stage').html($('#stage').html() + '<p>Stage 3 Complete</p>');
      }
      function stage4()
      {
        loadSync("http://asset03.drivewebsite.com/Global/Scripts/loadr.js?v=10");
        $('#stage').html($('#stage').html() + '<p>Stage 4 Complete</p>');
      }
      function stage5()
      {
        loadSync("http://asset03.drivewebsite.com/Site/3901b2b4-2cad-4c81-84b7-b068ae4ceb48/js/SiteScripts.js");
        $('#stage').html($('#stage').html() + '<p>Stage 5 Complete</p>');
      }
      function stage6()
      {
        loadSync('http://asset02.drivewebsite.com/prod-web/Scripts/libs/jquery/plugins/jquery.flexslider-min.js?v=1');
        $('#stage').html($('#stage').html() + '<p>Stage 6 Complete</p>');
      }
      function stage7()
      {
        loadSync('http://asset04.drivewebsite.com/prod-web/Scripts/Inventory/search.js?v=10');
        $('#stage').html($('#stage').html() + '<p>Stage 7 Complete</p>');
      }
      function stage8()
      {
        loadSync('http://asset04.drivewebsite.com/prod-web/Scripts/Inventory/searchDropdowns.js?v=10');
        $('#stage').html($('#stage').html() + '<p>Stage 8 Complete</p>');
      }
    </script>
</html>
